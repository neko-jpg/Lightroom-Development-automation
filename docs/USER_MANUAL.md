# Junmai AutoDev ユーザーマニュアル

## 目次
1. [はじめに](#はじめに)
2. [基本的なワークフロー](#基本的なワークフロー)
3. [ホットフォルダー監視](#ホットフォルダー監視)
4. [AI 自動選別](#ai-自動選別)
5. [コンテキスト認識型現像](#コンテキスト認識型現像)
6. [承認ワークフロー](#承認ワークフロー)
7. [自動書き出し](#自動書き出し)
8. [セッション管理](#セッション管理)
9. [デスクトップ GUI の使い方](#デスクトップ-gui-の使い方)
10. [モバイル Web UI の使い方](#モバイル-web-ui-の使い方)
11. [設定のカスタマイズ](#設定のカスタマイズ)
12. [学習機能](#学習機能)
13. [統計とレポート](#統計とレポート)

---

## はじめに

Junmai AutoDev は、写真家のワークフロー全体を自動化・最適化するシステムです。撮影後の写真を指定フォルダにコピーするだけで、以下の処理が自動的に実行されます:

1. **自動取り込み**: Lightroom カタログへの取り込み
2. **AI 選別**: 品質評価と星評価の自動付与
3. **コンテキスト認識**: 撮影状況の自動判定
4. **自動現像**: 最適なプリセットの適用
5. **承認**: 簡単な確認と承認
6. **自動書き出し**: 複数フォーマットでの書き出し

### 主な特徴

- **完全無料**: OSS LLM（Ollama + Llama 3.1）使用、API キー不要
- **ローカル処理**: すべての処理がローカルで完結、プライバシー保護
- **バックグラウンド実行**: 他の作業中も自動処理が進行
- **GPU 最適化**: RTX 4060 8GB で快適動作
- **学習機能**: 使うほど精度が向上

---

## 基本的なワークフロー

### 標準的な使用フロー

```
1. 撮影
   ↓
2. SD カードから写真をホットフォルダーにコピー
   ↓
3. 自動処理開始（バックグラウンド）
   - 取り込み
   - EXIF 解析
   - AI 評価
   - コンテキスト判定
   - 現像適用
   ↓
4. 承認キューで確認
   ↓
5. 承認 → 自動書き出し
```

### 所要時間の目安

| 工程 | 従来 | Junmai AutoDev |
|------|------|----------------|
| 取り込み | 5分 | 自動（5分） |
| 選別（100枚） | 30分 | 自動（2分） |
| 現像（50枚） | 60分 | 自動（10分） |
| 承認 | - | 5分 |
| 書き出し | 10分 | 自動（5分） |
| **合計** | **105分** | **実作業 5分** |

---

## ホットフォルダー監視

### 設定方法

1. **デスクトップ GUI** を起動

2. **設定** タブを開く

3. **ホットフォルダー** セクションで **追加** をクリック

4. 監視したいフォルダを選択（例: `D:/Photos/Inbox`）

5. **保存** をクリック

### 使い方

1. SD カードから写真を選択

2. ホットフォルダーにコピー（ドラッグ＆ドロップ可）

3. 自動的に処理が開始されます

### 対応ファイル形式

- **RAW**: CR3, CR2, NEF, ARW, RAF, ORF, DNG
- **JPEG**: JPG, JPEG
- **その他**: TIFF, PNG（参照用）

### 注意事項

- ファイルの書き込みが完了するまで待機します（大容量ファイルも安全）
- 同名ファイルは自動的にスキップされます
- サブフォルダも監視対象です

---

## AI 自動選別

### 評価基準

AI は以下の要素を総合的に評価します:

#### 1. ピント精度（Focus Score）
- Laplacian variance による鮮鋭度評価
- 顔検出時は顔領域を重点評価

#### 2. 露出適正（Exposure Score）
- ヒストグラム分析
- 白飛び・黒つぶれの検出
- 適正露出範囲の判定

#### 3. 構図バランス（Composition Score）
- Rule of thirds（三分割法）
- 被写体の配置
- 余白のバランス

#### 4. 被写体評価
- 顔検出と表情評価
- 被写体の明瞭度
- 背景とのコントラスト

### 星評価の意味

| 星 | 評価 | 推奨アクション |
|----|------|----------------|
| ★★★★★ (5.0) | 傑作 | 即採用、優先現像 |
| ★★★★☆ (4.0-4.9) | 優秀 | 採用推奨 |
| ★★★☆☆ (3.0-3.9) | 良好 | 条件付き採用 |
| ★★☆☆☆ (2.0-2.9) | 平凡 | 要検討 |
| ★☆☆☆☆ (1.0-1.9) | 不良 | 不採用推奨 |

### 類似写真のグループ化

連写や同じ構図の写真は自動的にグループ化され、最良の 1 枚が選択されます。

**例**:
```
IMG_5430.CR3 ★★★☆☆ 3.2
IMG_5431.CR3 ★★★★☆ 4.8 ← 自動選択
IMG_5432.CR3 ★★★★☆ 4.2
```

### 選別結果の確認

Lightroom で以下のコレクションが自動作成されます:

- **現像推奨（4星以上）**: 自動現像対象
- **要検討（3星）**: 手動確認推奨
- **不採用（2星以下）**: スキップ

---

## コンテキスト認識型現像

### コンテキストの種類

システムは EXIF データと画像解析から、以下のコンテキストを自動判定します:

#### 1. 逆光ポートレート（Backlit Portrait）
- **条件**: 人物 + 逆光 + ゴールデンアワー
- **適用プリセット**: WhiteLayer_Transparency_v4（60% blend）
- **調整**: ハイライト抑制、シャドウ持ち上げ

#### 2. 室内低照度（Low Light Indoor）
- **条件**: ISO 1600以上 + 室内
- **適用プリセット**: LowLight_NR_v2（80% blend）
- **調整**: ノイズ軽減、シャドウ強化

#### 3. 風景・青空（Landscape Sky）
- **条件**: 広角 + 青空検出
- **適用プリセット**: Landscape_Vivid_v3（70% blend）
- **調整**: 青空強調、コントラスト向上

#### 4. 夜景（Night Scene）
- **条件**: 夜間 + 長時間露光
- **適用プリセット**: Night_Clarity_v2（65% blend）
- **調整**: 明瞭度向上、ノイズ軽減

#### 5. スポーツ・動体（Sports Action）
- **条件**: 高速シャッター + 望遠
- **適用プリセット**: Action_Sharp_v1（75% blend）
- **調整**: シャープネス強化

### コンテキスト判定の確認

デスクトップ GUI の **承認キュー** で、各写真のコンテキストを確認できます:

```
Context: Backlit Portrait
Preset: WhiteLayer_Transparency_v4 (60% blend)
```

### カスタムコンテキストの追加

`local_bridge/context_engine.py` を編集して、独自のコンテキストを追加できます。

---

## 承認ワークフロー

### デスクトップ GUI での承認

1. **承認キュー** タブを開く

2. Before/After の比較画像を確認

3. 以下のいずれかを選択:
   - **✓ 承認**: 書き出しキューに追加
   - **✗ 却下**: 不採用として記録
   - **✏️ 修正**: Lightroom で手動調整
   - **⏭️ スキップ**: 後で判断

### キーボードショートカット

| キー | アクション |
|------|-----------|
| → | 次の写真 |
| ← | 前の写真 |
| Enter | 承認 |
| Delete | 却下 |
| Space | スキップ |
| E | Lightroom で編集 |

### モバイル Web UI での承認

1. スマートフォンで `http://[サーバーIP]:5100` にアクセス

2. **承認キュー** を開く

3. スワイプ操作:
   - **右スワイプ**: 承認
   - **左スワイプ**: 却下
   - **タップ**: 詳細表示

### 一括承認

複数の写真を一度に承認する場合:

1. 承認キューで写真を選択（Ctrl+クリック）

2. **一括承認** ボタンをクリック

---

## 自動書き出し

### 書き出しプリセットの設定

`config.json` で書き出し設定を定義:

```json
"export": {
  "presets": [
    {
      "name": "SNS",
      "enabled": true,
      "format": "JPEG",
      "quality": 85,
      "max_dimension": 2048,
      "color_space": "sRGB",
      "destination": "D:/Export/SNS"
    },
    {
      "name": "Print",
      "enabled": false,
      "format": "JPEG",
      "quality": 95,
      "max_dimension": 4096,
      "color_space": "AdobeRGB",
      "destination": "D:/Export/Print"
    }
  ]
}
```

### 書き出しの実行

#### 自動書き出し

`config.json` で `auto_export: true` に設定すると、承認後に自動的に書き出されます。

#### 手動書き出し

1. デスクトップ GUI の **セッション** タブを開く

2. セッションを選択

3. **書き出し** ボタンをクリック

4. 書き出しプリセットを選択

### クラウド同期

書き出し後、自動的にクラウドストレージにアップロードできます:

```json
"cloud_sync": {
  "enabled": true,
  "provider": "dropbox",
  "remote_path": "/Photos/Processed"
}
```

対応プロバイダー:
- Dropbox
- Google Drive
- OneDrive
- FTP/SFTP

---

## セッション管理

### セッションとは

セッションは、撮影日時やフォルダ構造から自動的に作成される作業単位です。

**例**:
```
2025-11-08_Wedding
2025-11-07_Portrait
2025-11-06_Landscape
```

### セッションの確認

デスクトップ GUI の **セッション** タブで、すべてのセッションを確認できます:

```
📁 2025-11-08_Wedding
   45/120 photos (38%)
   Status: Developing
   ETA: 12 min
```

### セッション操作

- **一時停止**: 処理を一時停止
- **再開**: 処理を再開
- **再現像**: 新しいプリセットで再現像
- **削除**: セッションを削除（写真は削除されません）

### セッション統計

各セッションの統計情報を確認できます:

- 総枚数
- 採用率
- 平均処理時間
- 使用プリセット

---

## デスクトップ GUI の使い方

### ダッシュボード

システムの全体状況を一目で確認できます:

```
● System Status: Running
● LLM: Ollama (Llama 3.1)
● Lightroom: Connected
● GPU: 45°C (2.1GB/8GB)

Today: 127 photos processed | 94% success | 2.3s avg
```

### アクティブセッション

現在処理中のセッションが表示されます:

```
📁 2025-11-08_Wedding (45/120 photos) [▓▓▓▓░░] 38%
   Status: Developing | ETA: 12 min
```

### 最近のアクティビティ

処理ログがリアルタイムで表示されます:

```
14:32 | ✓ Processed IMG_5432.CR3 (Portrait, 4.2★)
14:31 | ✓ Processed IMG_5431.CR3 (Portrait, 4.8★)
14:30 | ⚠ Skipped IMG_5430.CR3 (Low quality, 2.1★)
```

### クイックアクション

よく使う操作にすばやくアクセスできます:

- **📂 ホットフォルダー追加**
- **⚙️ 設定**
- **📊 統計**
- **✅ 承認キュー**
- **📤 今すぐ書き出し**

---

## モバイル Web UI の使い方

### アクセス方法

1. デスクトップとスマートフォンを同じネットワークに接続

2. スマートフォンのブラウザで以下にアクセス:
   ```
   http://[デスクトップのIPアドレス]:5100
   ```

3. ホーム画面に追加（PWA として使用可能）

### ダッシュボード

システムステータスとセッション一覧を表示:

```
● System Running
● LR Connected

Today
127 photos
94% success

Active Sessions
📁 Wedding
45/120 (38%)
▓▓▓▓░░░░░░
ETA: 12 min
```

### 承認インターフェース

スワイプ操作で効率的に承認:

```
← Approval (1/12)

[Image]

★★★★☆ 4.2
Backlit Portrait

WhiteLayer v4 (60%)

Swipe ← Reject
Swipe → Approve
Tap for Details
```

### プッシュ通知

処理完了やエラー発生時に通知を受け取れます:

1. 初回アクセス時に通知許可を求められます

2. **許可** をタップ

3. 以降、重要なイベントで通知が届きます

---

## 設定のカスタマイズ

### AI 設定

#### LLM モデルの変更

```json
"ai": {
  "llm_model": "llama3.1:11b-instruct"
}
```

利用可能なモデル:
- `llama3.1:8b-instruct` (推奨、高速)
- `llama3.1:11b-instruct` (高品質)
- `mixtral:8x7b` (最高品質、要16GB VRAM)

#### 選別閾値の調整

```json
"selection_threshold": 3.5
```

- **3.0**: より多くの写真を採用（寛容）
- **4.0**: 厳選（厳格）

### 処理設定

#### 同時実行ジョブ数

```json
"max_concurrent_jobs": 3
```

- **1-2**: 低スペック PC
- **3-4**: 推奨
- **5以上**: ハイエンド PC

#### CPU 使用率制限

```json
"cpu_limit_percent": 80
```

他の作業を妨げないよう、CPU 使用率を制限します。

#### GPU 温度制限

```json
"gpu_temp_limit_celsius": 75
```

GPU 温度がこの値を超えると、処理が一時停止します。

### 通知設定

#### デスクトップ通知

```json
"notifications": {
  "desktop": true
}
```

#### メール通知

```json
"email": {
  "enabled": true,
  "smtp_server": "smtp.gmail.com",
  "smtp_port": 587,
  "from_address": "your-email@gmail.com",
  "to_address": "your-email@gmail.com",
  "password": "your-app-password"
}
```

#### LINE 通知

```json
"line": {
  "enabled": true,
  "token": "your-line-notify-token"
}
```

LINE Notify トークンの取得方法:
1. https://notify-bot.line.me/ にアクセス
2. **マイページ** → **トークンを発行する**
3. トークンをコピーして設定

---

## 学習機能

### 学習の仕組み

システムはあなたの承認・却下履歴を学習し、徐々に精度が向上します:

1. **承認パターンの分析**: どのような写真を採用するか
2. **パラメータ調整の学習**: どのような調整を好むか
3. **カスタムプリセットの生成**: あなた専用のプリセット

### 学習データの確認

デスクトップ GUI の **統計** タブで学習状況を確認できます:

```
学習データ: 523 件
承認率: 87%
平均調整:
  - Exposure: +0.15 EV
  - Shadows: +8
  - Orange Sat: -4
```

### カスタムプリセットの生成

十分なデータが蓄積されると、自動的にカスタムプリセットが生成されます:

```
✓ Custom preset generated: "YourStyle_Portrait_v1"
  Based on 150 approved photos
  Approval rate: 92%
```

### 学習データのリセット

学習をやり直したい場合:

1. デスクトップ GUI の **設定** タブを開く

2. **詳細設定** → **学習データをリセット**

3. 確認ダイアログで **はい** をクリック

---

## 統計とレポート

### 日次統計

毎日の処理状況を確認:

```
2025-11-08
取り込み: 127 枚
選別: 94 枚採用 (74%)
現像: 89 枚完了
書き出し: 76 枚
平均処理時間: 2.3 秒/枚
```

### 週次・月次統計

長期的な傾向を分析:

```
2025年11月 (1-8日)
総取り込み: 1,234 枚
採用率: 76%
最も使用されたプリセット:
  1. WhiteLayer_Transparency_v4 (342回)
  2. Landscape_Vivid_v3 (198回)
  3. LowLight_NR_v2 (156回)
```

### グラフ表示

統計データをグラフで可視化:

- 日別処理枚数
- 採用率の推移
- プリセット使用頻度
- 処理時間の推移

### レポートのエクスポート

統計データを PDF または CSV でエクスポート:

1. **統計** タブを開く

2. **エクスポート** ボタンをクリック

3. 形式を選択（PDF / CSV）

4. 保存先を指定

---

## ベストプラクティス

### 効率的な使い方

1. **バッチ処理**: 複数のセッションをまとめて処理
2. **夜間処理**: 就寝前に投入し、朝には完了
3. **モバイル承認**: 移動中にスマホで承認
4. **定期的な学習**: 月に一度、学習データを確認

### 品質を保つコツ

1. **初期設定を丁寧に**: ホットフォルダーとプリセットを適切に設定
2. **定期的な確認**: 承認キューを毎日チェック
3. **フィードバック**: 却下理由を記録して学習精度を向上
4. **プリセットの更新**: 作風の変化に合わせてプリセットを調整

### トラブル回避

1. **ディスク容量**: 常に 50GB 以上の空き容量を確保
2. **GPU 温度**: 夏場は冷却に注意
3. **バックアップ**: Lightroom カタログを定期的にバックアップ
4. **ログ確認**: エラーが発生したらログを確認

---

## サポート

### ドキュメント

- [インストールガイド](INSTALLATION_GUIDE.md)
- [トラブルシューティング](TROUBLESHOOTING.md)
- [FAQ](FAQ.md)

### コミュニティ

- GitHub Issues: https://github.com/your-repo/junmai-autodev/issues
- Discord: https://discord.gg/junmai-autodev

### お問い合わせ

技術的な質問や機能要望は GitHub Issues でお願いします。

---

© 2025 Junmai AutoDev Project
