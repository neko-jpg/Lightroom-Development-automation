# Junmai AutoDev - Deployment Guide

Version: 2.0  
Last Updated: 2025-11-09

## Overview

This guide covers the complete deployment process for Junmai AutoDev, including building executables, creating installers, and distributing releases.

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Build Process](#build-process)
3. [Creating Installers](#creating-installers)
4. [Testing](#testing)
5. [Distribution](#distribution)
6. [Auto-Update System](#auto-update-system)
7. [Troubleshooting](#troubleshooting)

## Prerequisites

### Development Environment

#### Windows
- Windows 10/11 (64-bit)
- Python 3.9-3.11
- Visual Studio Build Tools (for some dependencies)
- Inno Setup 6 (for installer creation)
- Git

#### macOS
- macOS 12+ (Monterey or later)
- Python 3.9-3.11
- Xcode Command Line Tools
- Homebrew
- Git

#### Linux
- Ubuntu 20.04+ or equivalent
- Python 3.9-3.11
- Build essentials
- Git

### Python Dependencies

Install all required dependencies:

```bash
pip install -r requirements.txt
```

Key build dependencies:
- PyInstaller 6.3.0+
- packaging 23.2+

## Build Process

### Quick Build

For a complete build with all steps:

```bash
python build_all.py
```

This will:
1. Build the executable with PyInstaller
2. Create platform-specific installer
3. Generate checksums
4. Create release notes

### Step-by-Step Build

#### 1. Configure Build

Edit `build_config.py` to customize:
- Application metadata (name, version, author)
- Icon paths
- Data files to include
- Hidden imports
- Excluded modules

#### 2. Build Executable

```bash
python build.py
```

Options:
- `--clean`: Clean build directories before building
- `--no-archive`: Skip creating distribution archive
- `--sign`: Sign the executable (requires configuration)

Output: `dist/JunmaiAutoDev/`

#### 3. Create Installer

```bash
python create_installer.py
```

Platform-specific outputs:
- **Windows**: `installers/JunmaiAutoDev-2.0.0-Setup.exe`
- **macOS**: `installers/JunmaiAutoDev-2.0.0.dmg`
- **Linux**: `installers/JunmaiAutoDev-2.0.0-linux.tar.gz`

#### 4. Generate Checksums

Checksums are automatically generated by `build_all.py`, or manually:

```bash
cd installers
sha256sum * > SHA256SUMS.txt  # Linux/macOS
# or
certutil -hashfile <filename> SHA256  # Windows
```

## Creating Installers

### Windows Installer (Inno Setup)

1. Install Inno Setup from https://jrsoftware.org/isdl.php

2. The installer script is automatically generated in `installers/JunmaiAutoDev.iss`

3. Features:
   - Checks for Python installation
   - Creates Start Menu shortcuts
   - Creates desktop icon (optional)
   - Initializes database on first run
   - Uninstaller included

4. Customization:
   - Edit the generated `.iss` file
   - Modify `_create_inno_setup_script()` in `create_installer.py`

### macOS Installer (DMG)

1. The DMG is created using `hdiutil`

2. Features:
   - Drag-and-drop installation
   - Code signing support (if configured)
   - Notarization support (if configured)

3. Code Signing (optional):
   ```bash
   codesign --deep --force --verify --verbose \
     --sign "Developer ID Application: Your Name" \
     JunmaiAutoDev.app
   ```

4. Notarization (optional):
   ```bash
   xcrun notarytool submit JunmaiAutoDev-2.0.0.dmg \
     --apple-id your@email.com \
     --team-id TEAMID \
     --password app-specific-password
   ```

### Linux Package

Currently creates a `.tar.gz` archive. Future enhancements:

#### Debian Package (.deb)
```bash
# Create package structure
mkdir -p junmai-autodev_2.0.0/DEBIAN
mkdir -p junmai-autodev_2.0.0/usr/local/bin
mkdir -p junmai-autodev_2.0.0/usr/share/applications

# Create control file
cat > junmai-autodev_2.0.0/DEBIAN/control << EOF
Package: junmai-autodev
Version: 2.0.0
Architecture: amd64
Maintainer: Junmai AutoDev Team
Description: Lightroom × LLM Auto Development System
EOF

# Build package
dpkg-deb --build junmai-autodev_2.0.0
```

#### RPM Package (.rpm)
```bash
# Create spec file and build with rpmbuild
rpmbuild -ba junmai-autodev.spec
```

## Testing

### Pre-Release Testing Checklist

#### Functional Testing
- [ ] Application launches successfully
- [ ] GUI displays correctly
- [ ] Hot folder monitoring works
- [ ] EXIF analysis functions
- [ ] AI selection operates
- [ ] Lightroom integration works
- [ ] WebSocket communication stable
- [ ] Export pipeline functions
- [ ] Notifications work
- [ ] Settings save/load correctly

#### Platform-Specific Testing
- [ ] Windows 10
- [ ] Windows 11
- [ ] macOS 12 (Monterey)
- [ ] macOS 13 (Ventura)
- [ ] macOS 14 (Sonoma)
- [ ] Ubuntu 20.04
- [ ] Ubuntu 22.04

#### Installation Testing
- [ ] Clean install works
- [ ] Upgrade from previous version works
- [ ] Uninstall removes all files
- [ ] Desktop shortcuts work
- [ ] Start menu entries work (Windows)
- [ ] Application bundle works (macOS)

#### Performance Testing
- [ ] Startup time < 5 seconds
- [ ] Memory usage < 1 GB idle
- [ ] GPU usage appropriate
- [ ] CPU usage reasonable
- [ ] No memory leaks
- [ ] Handles 1000+ photos

### Automated Testing

Run the test suite before release:

```bash
# Unit tests
cd local_bridge
py -m pytest test_*.py

# Integration tests
py run_integration_tests.py

# Performance tests
py test_performance_benchmark.py

# UAT tests
py uat_test_runner.py
```

## Distribution

### GitHub Releases

1. Create a new release on GitHub:
   ```bash
   git tag -a v2.0.0 -m "Release version 2.0.0"
   git push origin v2.0.0
   ```

2. Upload installers:
   - Windows: `JunmaiAutoDev-2.0.0-Setup.exe`
   - macOS: `JunmaiAutoDev-2.0.0.dmg`
   - Linux: `JunmaiAutoDev-2.0.0-linux.tar.gz`
   - Checksums: `SHA256SUMS.txt`

3. Add release notes from `installers/RELEASE_NOTES.md`

### Update Channels

Configure update channels in `auto_updater.py`:

- **Stable**: Production releases (default)
- **Beta**: Pre-release testing
- **Dev**: Development builds

### Version Numbering

Follow Semantic Versioning (semver.org):
- **Major** (X.0.0): Breaking changes
- **Minor** (0.X.0): New features, backward compatible
- **Patch** (0.0.X): Bug fixes

## Auto-Update System

### Configuration

The auto-updater checks for updates from:
```python
update_url = "https://api.github.com/repos/junmai/autodev/releases/latest"
```

### Update Process

1. **Check**: Application checks for updates on startup (configurable)
2. **Download**: Downloads new version in background
3. **Verify**: Validates checksum
4. **Extract**: Extracts update files
5. **Backup**: Creates backup of current version
6. **Apply**: Replaces files with new version
7. **Restart**: Restarts application

### Manual Update

Users can manually check for updates:
- GUI: Help → Check for Updates
- CLI: `python auto_updater.py`

### Rollback

If update fails, automatic rollback occurs:
1. Restore from backup
2. Log error details
3. Notify user

## Code Signing

### Windows

1. Obtain code signing certificate
2. Configure in `build_config.py`:
   ```python
   WINDOWS_SIGN_TOOL = r"C:\Program Files (x86)\Windows Kits\10\bin\x64\signtool.exe"
   WINDOWS_CERTIFICATE = r"C:\path\to\certificate.pfx"
   ```

3. Sign executable:
   ```bash
   python build.py --sign
   ```

### macOS

1. Obtain Developer ID certificate
2. Configure in `build_config.py`:
   ```python
   MACOS_CODESIGN_IDENTITY = "Developer ID Application: Your Name (TEAMID)"
   ```

3. Sign and notarize:
   ```bash
   python build.py --sign
   ```

## Troubleshooting

### Build Issues

#### PyInstaller Fails
- **Cause**: Missing dependencies or incompatible versions
- **Solution**: Update PyInstaller, check hidden imports

#### Large Executable Size
- **Cause**: Including unnecessary modules
- **Solution**: Add to `EXCLUDED_MODULES` in `build_config.py`

#### Missing DLLs (Windows)
- **Cause**: PyInstaller didn't detect dependencies
- **Solution**: Add to `binaries` in spec file

### Installer Issues

#### Inno Setup Not Found (Windows)
- **Solution**: Install from https://jrsoftware.org/isdl.php

#### DMG Creation Fails (macOS)
- **Cause**: Insufficient permissions or disk space
- **Solution**: Check permissions, free up space

### Runtime Issues

#### Application Won't Start
- **Cause**: Missing dependencies or corrupted files
- **Solution**: Reinstall, check logs

#### GPU Not Detected
- **Cause**: NVIDIA drivers not installed
- **Solution**: Install latest NVIDIA drivers

#### Database Initialization Fails
- **Cause**: Insufficient permissions
- **Solution**: Run with appropriate permissions

## Best Practices

### Before Release

1. **Version Bump**: Update version in `build_config.py`
2. **Changelog**: Update `CHANGELOG.md`
3. **Documentation**: Update all docs
4. **Testing**: Run full test suite
5. **Clean Build**: Use `--clean` flag
6. **Verify**: Test installer on clean system

### Release Process

1. **Tag**: Create git tag
2. **Build**: Run `build_all.py`
3. **Test**: Install and test on all platforms
4. **Sign**: Code sign if applicable
5. **Upload**: Upload to GitHub releases
6. **Announce**: Notify users

### Post-Release

1. **Monitor**: Watch for bug reports
2. **Support**: Respond to issues
3. **Metrics**: Track download statistics
4. **Feedback**: Collect user feedback
5. **Plan**: Plan next release

## Security Considerations

### Code Signing
- Always sign releases for production
- Protect signing certificates
- Use hardware security modules (HSM) if possible

### Update Security
- Use HTTPS for update checks
- Verify checksums before applying updates
- Implement rollback mechanism

### Credentials
- Never include API keys in builds
- Use environment variables
- Implement secure credential storage

## Support

For build and deployment issues:
- GitHub Issues: https://github.com/junmai/autodev/issues
- Email: dev@junmai-autodev.com
- Documentation: https://github.com/junmai/autodev/wiki

## License

This deployment guide is part of Junmai AutoDev and is licensed under the MIT License.

---

**Last Updated**: 2025-11-09  
**Version**: 2.0  
**Maintainer**: Junmai AutoDev Team
